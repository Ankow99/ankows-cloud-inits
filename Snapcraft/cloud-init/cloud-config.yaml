#cloud-config
ssh_import_id: ['lp:pgdg99']
ssh_authorized_keys: [ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJarMH7ITZbBSf6iA8RzneJfgDQt3H9pDs1lm+RjmAXq pablo.degreiff@canonical.com]
ssh_genkeytypes: [ed25519]

write_files:
- path: /etc/profile.d/default-editor.sh
  permissions: '0644'
  content: |
    export EDITOR=nvim

- path: /etc/sudoers.d/keep-editor
  permissions: '0440'
  content: |
    Defaults env_keep += "EDITOR"

package_update: true
package_upgrade: true
package_reboot_if_required: true

snap:
  commands:
  - snap install snapcraft --classic
  - snap install lxd

packages:
  - git
  - neovim
  - pollinate

timezone: America/Bogota

random_seed:
  command: [pollinate]
  command_required: true
  file: /dev/urandom

runcmd:

# Create Snapcraft credentials file
- echo "\n\n-------- Creating Snapcraft Credentials File... --------\n"

- |
  cat <<EOF > /home/ubuntu/.snapcraft-credentials
  [INSERT YOUR CREDENTIALS HERE]
  EOF

- chown ubuntu:ubuntu /home/ubuntu/.snapcraft-credentials

# Add Snapcraft credentials file to bashrc
- echo "\n\n-------- Adding Snapcraft Credentials File to bashrc... --------\n"

- echo 'export SNAPCRAFT_STORE_CREDENTIALS=$(cat $HOME/.snapcraft-credentials)' >> /home/ubuntu/.bashrc

# Initialize LXD
- echo "\n\n-------- Initialize LXD... --------\n"

- lxd init --auto

